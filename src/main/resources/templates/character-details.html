<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Character Details</title>
  <link rel="stylesheet" href="/character-details.css">
</head>
<body>
<div class="character-details-container">
  <div class="character-image" th:if="${character.characterPicUrl != null}">
    <img th:src="@{${character.characterPicUrl}}" alt="Character Picture">
  </div>
  <div class="character-image" th:if="${character.characterPicUrl == null}">
    <img src="/images/default-character.png" alt="Default Character Picture">
  </div>

  <div class="character-name" th:text="${character.characterName}">Character Name</div>

  <div class="character-info">
    <strong>Level:</strong> <span th:text="${character.characterLevel}">1</span>
  </div>
  <div class="character-info">
    <strong>Species:</strong> <span th:text="${character.characterSpecies}">Species</span>
  </div>
  <div class="character-info">
    <strong>Subspecies:</strong> <span th:text="${character.characterSubspecies}">Subspecies</span>
  </div>
  <div class="character-info">
    <strong>Class:</strong> <span th:text="${character.characterClass}">Class</span>
  </div>
  <div class="character-info">
    <strong>Subclass:</strong> <span th:text="${character.characterSubclass}">Subclass</span>
  </div>
  <div class="character-info">
    <strong>Strength:</strong> <span th:text="${character.characterStrength}">Strength</span>
  </div>
  <div class="character-info">
    <strong>Dexterity:</strong> <span th:text="${character.characterDexterity}">Dexterity</span>
  </div>
  <div class="character-info">
    <strong>Constitution:</strong> <span th:text="${character.characterConstitution}">Constitution</span>
  </div>
  <div class="character-info">
    <strong>Intelligence:</strong> <span th:text="${character.characterIntelligence}">Intelligence</span>
  </div>
  <div class="character-info">
    <strong>Wisdom:</strong> <span th:text="${character.characterWisdom}">Wisdom</span>
  </div>
  <div class="character-info">
    <strong>Charisma:</strong> <span th:text="${character.characterCharisma}">Charisma</span>
  </div>
  <div class="character-info">
    <strong>HP:</strong> <span th:text="${character.characterCurrentHp} + '/' + ${character.characterMaxHp}">HP</span>
  </div>
  <div class="character-info">
    <strong>Armour Class:</strong> <span th:text="${character.characterArmourClass}">Armour Class</span>
  </div>
  <div class="character-info">
    <strong>Coins:</strong> <span th:text="${character.characterCoin}">Coins</span>
  </div>
  <div class="character-info">
    <strong>Proficiency Bonus:</strong> <span th:text="${character.characterProficiencyBonus}">Bonus</span>
  </div>

        </div>

        <button id="goToAbilityScores">Go to Ability Scores</button>
        <script>
            // Wait for the DOM content to load
            document.addEventListener("DOMContentLoaded", function() {
                // Get references to the button and input fields
                const saveButton = document.getElementById("save-button");
                const nameInput = document.getElementById("character-name");
                const picInput = document.getElementById("character-pic-url");
                const descriptionInput = document.getElementById("character-description");
                const outputDiv = document.getElementById("output");
                const characterId = [[${characterId}]];

                // Add event listener to the Save button
                saveButton.addEventListener("click", function() {
                    // Get the input values
                    const name = nameInput.value;
                    const picUrl = picInput.value;
                    const description = descriptionInput.value;
                    submit({
                        "name": name,
                        "picUrl": picUrl,
                        "description": description
                    });


                    // Display the values dynamically in the output area
                    outputDiv.innerHTML = `
                        <h2>${name}</h2>
                        <img src="${picUrl}" alt="${name}" style="max-width: 200px; height: auto;"/>
                        <p>${description}</p>
                    `;
                });
                document.getElementById("goToAbilityScores").addEventListener("click", function() {
                    window.location.href = `/abilityScores/${characterId}`;
                });
            });
            function submit(details) {

                fetch(`/characterDetails/[[${characterId}]]`, {
                    method: 'PATCH', // HTTP method
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(details)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                     return response.json();
                }).then(data => {
                    if (data.redirectUrl) {
                        window.location.href = data.redirectUrl;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("An error occurred while saving the data.");
                });
            }
        </script>

    </div>

  <a href="/all-characters" class="button-back">Back to Characters</a>
</div>

</body>
</html>
